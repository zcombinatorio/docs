---
title: "Confirm Fee Claim Transaction"
description: "POST /fee-claim/confirm - Submit signed fee claim transaction to the blockchain"
---

## Overview

Confirms and submits a signed fee claim transaction to the Solana blockchain. This endpoint validates the transaction structure, adds the LP owner's signature, and broadcasts it to the network. The transaction claims fees from a Meteora DAMM v2 pool and transfers 70% to the configured destination address.

<Warning>
**Pool locking mechanism**: This endpoint uses a mutex lock system to prevent concurrent fee claims for the same pool, ensuring transaction integrity.
</Warning>

<CodeGroup>

```bash curl
curl -X POST https://api.zcombinator.io/fee-claim/confirm \
  -H "Content-Type: application/json" \
  -d '{
    "signedTransaction": "4MzR7dxJNJRVP1Q6k7Y3j8X...",
    "requestId": "a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6"
  }'
```

```javascript fetch
const response = await fetch('https://api.zcombinator.io/fee-claim/confirm', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    signedTransaction: "4MzR7dxJNJRVP1Q6k7Y3j8X...",
    requestId: "a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6"
  })
});

const result = await response.json();
```

```python requests
import requests

data = {
    "signedTransaction": "4MzR7dxJNJRVP1Q6k7Y3j8X...",
    "requestId": "a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6"
}

response = requests.post(
    'https://api.zcombinator.io/fee-claim/confirm',
    json=data,
    headers={'Content-Type': 'application/json'}
)

result = response.json()
```

</CodeGroup>

## Request Parameters

<ParamField body="signedTransaction" type="string" required>
  Base58 encoded signed transaction from the user (must match the transaction from `/fee-claim/claim`)
</ParamField>

<ParamField body="requestId" type="string" required>
  Unique identifier returned from the `/fee-claim/claim` endpoint
</ParamField>

## Response

<ResponseField name="success" type="boolean">
  Indicates if the transaction was submitted successfully
</ResponseField>

<ResponseField name="signature" type="string">
  Transaction signature (transaction ID) on Solana
</ResponseField>

<ResponseField name="poolAddress" type="string">
  Address of the Meteora DAMM v2 pool
</ResponseField>

<ResponseField name="tokenAMint" type="string">
  Mint address of Token A in the pool
</ResponseField>

<ResponseField name="tokenBMint" type="string">
  Mint address of Token B in the pool
</ResponseField>

<ResponseField name="destinationAddress" type="string">
  Address that received 70% of the claimed fees
</ResponseField>

<ResponseField name="estimatedFees" type="object">
  Object containing the claimed fee amounts
</ResponseField>

<ResponseField name="message" type="string">
  Success message
</ResponseField>

### Success Response

```json
{
  "success": true,
  "signature": "5J8Z9xKqH4nL2pR7vT3mB1cW6dF8yG4aS9jK2xM5nP8hQ3rV7wE1",
  "poolAddress": "CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C",
  "tokenAMint": "EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v",
  "tokenBMint": "So11111111111111111111111111111111111111112",
  "destinationAddress": "FeeDestinationWalletAddress123456789",
  "positionsCount": 1,
  "estimatedFees": {
    "tokenA": "1000000",
    "tokenB": "500000000"
  },
  "message": "Fee claim transaction submitted successfully"
}
```

## Error Responses

<AccordionGroup>
  <Accordion title="400 - Missing Parameters">
    ```json
    {
      "error": "Missing required fields: signedTransaction and requestId"
    }
    ```
  </Accordion>

  <Accordion title="400 - Request Not Found">
    ```json
    {
      "error": "Fee claim request not found or expired. Please call /fee-claim/claim first."
    }
    ```
  </Accordion>

  <Accordion title="400 - Request Expired">
    ```json
    {
      "error": "Fee claim request expired. Please create a new request."
    }
    ```
  </Accordion>

  <Accordion title="400 - Expired Blockhash">
    ```json
    {
      "error": "Invalid transaction: blockhash is expired. Please create a new transaction."
    }
    ```
  </Accordion>

  <Accordion title="400 - Fee Payer Mismatch">
    ```json
    {
      "error": "Transaction fee payer mismatch"
    }
    ```
  </Accordion>

  <Accordion title="400 - Unauthorized Program">
    ```json
    {
      "error": "Invalid transaction: unauthorized program instruction detected"
    }
    ```
  </Accordion>

  <Accordion title="400 - Unauthorized Destination">
    ```json
    {
      "error": "Invalid transaction: transfer destination not authorized"
    }
    ```
  </Accordion>
</AccordionGroup>

## Process Flow

<Steps>
<Step title="Validate Parameters">
Ensures signedTransaction and requestId are provided
</Step>

<Step title="Retrieve Request Data">
Looks up the fee claim request data using the requestId
</Step>

<Step title="Acquire Pool Lock">
Obtains a mutex lock to prevent concurrent claims
</Step>

<Step title="Validate Blockhash">
Checks that the transaction's blockhash is recent (within last 150 slots)
</Step>

<Step title="Verify Fee Payer">
Ensures the fee payer matches and has signed
</Step>

<Step title="Validate Transaction Structure">
Comprehensive security validation of all instructions
</Step>

<Step title="Add LP Owner Signature">
Protocol signs with the LP owner keypair
</Step>

<Step title="Submit Transaction">
Broadcasts the fully-signed transaction to Solana
</Step>

<Step title="Cleanup">
Removes the request data and releases the pool lock
</Step>
</Steps>

## Security Validations

<AccordionGroup>
  <Accordion title="Lock System">
    Prevents race conditions by ensuring only one fee claim processes per pool at a time.
  </Accordion>

  <Accordion title="Blockhash Validation">
    Prevents replay attacks by verifying the blockhash is recent (~60 seconds).
  </Accordion>

  <Accordion title="Allowed Programs">
    Only permits instructions from Token Program, Associated Token Program, Compute Budget, Lighthouse, Meteora CP-AMM, and System Program.
  </Accordion>

  <Accordion title="Destination Validation">
    Transfers can ONLY go to configured destination address or LP owner token accounts.
  </Accordion>

  <Accordion title="Amount Validation">
    Transfer amounts are compared against stored expected fees to prevent over-claiming.
  </Accordion>
</AccordionGroup>

## Rate Limiting

This endpoint is subject to rate limiting:
- **10 requests** per 5-minute window per IP
- Returns HTTP 429 when limit exceeded

## Transaction Confirmation

You can view the transaction on Solscan: `https://solscan.io/tx/{signature}`

## Best Practices

<Steps>
<Step title="Check Blockhash Age">
Submit quickly after receiving from `/fee-claim/claim`. Blockhashes expire after ~60 seconds.
</Step>

<Step title="Handle Expiry">
If more than 10 minutes pass, create a new claim request.
</Step>

<Step title="Wait for Lock">
If you receive a timeout, the pool may be locked by another request. Wait and retry.
</Step>
</Steps>
