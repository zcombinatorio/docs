---
title: "Confirm Claim Transaction"
description: "POST /ico/:tokenAddress/claim/confirm - Submit signed claim transaction to receive tokens"
---

## Overview

Receives a user-signed claim transaction from [Prepare Claim](/api-reference/ico/claim-prepare), validates it, adds the escrow signature, and submits the complete transaction to the Solana blockchain to transfer tokens to the user.

<CodeGroup>

```bash curl
curl -X POST "https://api.zcombinator.io/ico/EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v/claim/confirm" \
  -H "Content-Type: application/json" \
  -d '{
    "signedTransaction": "AQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEDAhQn...",
    "requestId": "a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6"
  }'
```

```javascript fetch
const tokenAddress = "EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v";

const response = await fetch(
  `https://api.zcombinator.io/ico/${tokenAddress}/claim/confirm`,
  {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      signedTransaction: signedTransactionBase64,
      requestId: requestId
    })
  }
);

const result = await response.json();
```

```python requests
import requests

token_address = "EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"

data = {
    "signedTransaction": signed_transaction_base64,
    "requestId": request_id
}

response = requests.post(
    f'https://api.zcombinator.io/ico/{token_address}/claim/confirm',
    json=data,
    headers={'Content-Type': 'application/json'}
)

result = response.json()
```

</CodeGroup>

## URL Parameters

<ParamField path="tokenAddress" type="string" required>
  The Solana token mint address of the ICO
</ParamField>

## Request Parameters

<ParamField body="signedTransaction" type="string" required>
  Base64 encoded transaction signed by the user's wallet
</ParamField>

<ParamField body="requestId" type="string" required>
  Unique request identifier returned from [Prepare Claim](/api-reference/ico/claim-prepare)
</ParamField>

## Response

<ResponseField name="success" type="boolean">
  Indicates if the claim was successful
</ResponseField>

<ResponseField name="message" type="string">
  Human-readable success message
</ResponseField>

<ResponseField name="signature" type="string">
  The Solana transaction signature
</ResponseField>

### Success Response

```json
{
  "success": true,
  "message": "Claim recorded successfully",
  "signature": "5VfYiDvQMBSWxKJLa9NLPQ1x3..."
}
```

## Error Responses

<AccordionGroup>
  <Accordion title="400 - Missing Parameters">
    ```json
    {
      "error": "Missing required fields: signedTransaction and requestId"
    }
    ```
  </Accordion>

  <Accordion title="400 - Invalid Token Address">
    ```json
    {
      "error": "Invalid token address format"
    }
    ```
  </Accordion>

  <Accordion title="400 - Request Not Found">
    ```json
    {
      "error": "Claim request not found or expired. Please call /claim/prepare first."
    }
    ```
  </Accordion>

  <Accordion title="400 - Token Address Mismatch">
    ```json
    {
      "error": "Token address mismatch"
    }
    ```
  </Accordion>

  <Accordion title="400 - Request Expired">
    ```json
    {
      "error": "Claim request expired. Please create a new request."
    }
    ```
  </Accordion>

  <Accordion title="400 - Invalid Transaction">
    ```json
    {
      "error": "Invalid transaction format"
    }
    ```
  </Accordion>

  <Accordion title="400 - Sale Not Finalized">
    ```json
    {
      "error": "ICO sale is not finalized. Claiming is only allowed after the sale is complete.",
      "errorCode": "SALE_NOT_FINALIZED",
      "currentStatus": "active"
    }
    ```
  </Accordion>

  <Accordion title="400 - Invalid Blockhash">
    ```json
    {
      "error": "Invalid transaction: blockhash is expired. Please create a new transaction."
    }
    ```
  </Accordion>

  <Accordion title="400 - Invalid Fee Payer">
    ```json
    {
      "error": "Invalid transaction: fee payer must be user wallet"
    }
    ```
  </Accordion>

  <Accordion title="400 - Not Signed">
    ```json
    {
      "error": "Transaction not signed by user wallet"
    }
    ```
  </Accordion>

  <Accordion title="400 - Invalid Signature">
    ```json
    {
      "error": "Transaction verification failed: Invalid user wallet signature"
    }
    ```
  </Accordion>

  <Accordion title="400 - Transaction Tampered">
    ```json
    {
      "error": "Transaction verification failed: transaction has been modified",
      "details": "Transaction structure does not match the original unsigned transaction"
    }
    ```
  </Accordion>

  <Accordion title="400 - No Claimable Tokens">
    ```json
    {
      "error": "No claimable tokens found for this wallet"
    }
    ```
  </Accordion>

  <Accordion title="400 - Exceeds Available Tokens">
    ```json
    {
      "error": "Claim amount exceeds available tokens. Available: 1000000, Requested: 5000000"
    }
    ```
  </Accordion>

  <Accordion title="404 - ICO Not Found">
    ```json
    {
      "error": "ICO sale not found or not properly configured"
    }
    ```
  </Accordion>

  <Accordion title="500 - Transaction Submission Failed">
    ```json
    {
      "error": "Failed to submit transaction: [error message]"
    }
    ```
  </Accordion>

  <Accordion title="500 - Confirmation Failed">
    ```json
    {
      "error": "Transaction submitted but confirmation failed: [signature]. [error message]"
    }
    ```
  </Accordion>
</AccordionGroup>

## Security Validations

The server performs extensive security checks before processing:

<Steps>
<Step title="Request Lookup">
Retrieves stored transaction data using `requestId`
</Step>

<Step title="Token Address Match">
Confirms the token address matches the original request
</Step>

<Step title="Expiration Check">
Ensures the request is less than 10 minutes old
</Step>

<Step title="Sale Status">
Confirms the ICO sale status is `finalized` (not `active`)
</Step>

<Step title="Blockhash Validation">
Verifies the transaction blockhash is still valid
</Step>

<Step title="Fee Payer Check">
Confirms the fee payer matches the user wallet
</Step>

<Step title="Signature Verification">
Validates the user's cryptographic signature
</Step>

<Step title="Transaction Integrity">
Compares SHA-256 hash to detect any tampering
</Step>

<Step title="Balance Check">
Verifies user has enough tokens remaining to claim
</Step>
</Steps>

## Process Flow

<Steps>
<Step title="Validate Request">
Check request ID and token address match
</Step>

<Step title="Acquire Lock">
Obtain mutex lock for this token to prevent race conditions
</Step>

<Step title="Security Checks">
Run all validation steps above
</Step>

<Step title="Add Escrow Signature">
Sign transaction with escrow keypair
</Step>

<Step title="Submit Transaction">
Send fully-signed transaction to Solana blockchain
</Step>

<Step title="Wait for Confirmation">
Monitor until transaction is confirmed
</Step>

<Step title="Record Claim">
Update database with claimed amount
</Step>

<Step title="Cleanup">
Remove temporary request data
</Step>
</Steps>

## Rate Limiting

This endpoint is subject to rate limiting:
- **30 requests per IP** per 1-minute window
- Returns HTTP 429 when limit exceeded

## Transaction Verification

You can verify successful claims on Solana explorers:

```
https://solscan.io/tx/{signature}
```

## Integration Notes

<Warning>
**Do not submit to blockchain directly!** The transaction requires the escrow signature which only the server can provide. Always submit through this endpoint.
</Warning>

<Tip>
After a successful claim, call [Get Claim Info](/api-reference/ico/claim-info) to show the user their updated balance. The `tokens_claimed` field will reflect the new total.
</Tip>

## Complete Claim Flow Example

```javascript
// Full claim flow
async function claimTokens(tokenAddress, wallet) {
  // 1. Check sale is finalized
  const saleResponse = await fetch(
    `https://api.zcombinator.io/ico/${tokenAddress}`
  );
  const sale = await saleResponse.json();

  if (sale.status !== 'finalized') {
    throw new Error('Sale not finalized yet');
  }

  // 2. Check claimable balance
  const claimInfoResponse = await fetch(
    `https://api.zcombinator.io/ico/${tokenAddress}/claim?wallet=${wallet.publicKey}`
  );
  const claimInfo = await claimInfoResponse.json();

  const remaining = BigInt(claimInfo.tokens_claimable) - BigInt(claimInfo.tokens_claimed);
  if (remaining <= 0n) {
    throw new Error('No tokens to claim');
  }

  // 3. Prepare transaction
  const prepareResponse = await fetch(
    `https://api.zcombinator.io/ico/${tokenAddress}/claim/prepare`,
    {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ wallet: wallet.publicKey.toBase58() })
    }
  );
  const { transaction, requestId } = await prepareResponse.json();

  // 4. Sign transaction
  const txBuffer = Buffer.from(transaction, 'base64');
  const tx = VersionedTransaction.deserialize(txBuffer);
  const signedTx = await wallet.signTransaction(tx);

  // 5. Confirm claim
  const confirmResponse = await fetch(
    `https://api.zcombinator.io/ico/${tokenAddress}/claim/confirm`,
    {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        signedTransaction: Buffer.from(signedTx.serialize()).toString('base64'),
        requestId
      })
    }
  );

  return await confirmResponse.json();
}
```

## Next Steps

After confirming a claim:

1. **Verify on-chain**: Check the transaction signature on Solana explorer
2. **Check remaining balance**: [Get Claim Info](/api-reference/ico/claim-info)
3. **View purchase history**: [Get Purchase History](/api-reference/ico/purchase-history)
