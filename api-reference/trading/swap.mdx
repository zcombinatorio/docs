---
title: "Swap"
description: "Trade conditional tokens in proposal AMM pools"
---

## Overview

Execute swaps in a proposal's AMM pools to trade conditional tokens. Each proposal has two pools (pass and fail markets) where you can trade conditional tokens.

This is a two-step process:
1. **Build** - Request an unsigned transaction from the API
2. **Execute** - Sign the transaction and submit it back

---

## Build Transaction

`POST /dao/proposal/:proposalPda/swap/build`

Builds an unsigned swap transaction for the user to sign.

<CodeGroup>
```bash curl
curl -X POST https://api.zcombinator.io/dao/proposal/ABC123.../swap/build \
  -H "Content-Type: application/json" \
  -d '{
    "wallet": "UserWallet123...",
    "poolIndex": 0,
    "swapAToB": true,
    "inputAmount": "1000000000",
    "slippageBps": 200
  }'
```
```javascript fetch
const response = await fetch(
  'https://api.zcombinator.io/dao/proposal/ABC123.../swap/build',
  {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      wallet: 'UserWallet123...',
      poolIndex: 0,
      swapAToB: true,
      inputAmount: '1000000000',
      slippageBps: 200
    })
  }
);
const { requestId, transaction, quote } = await response.json();
```
```python requests
import requests

response = requests.post(
    'https://api.zcombinator.io/dao/proposal/ABC123.../swap/build',
    json={
        'wallet': 'UserWallet123...',
        'poolIndex': 0,
        'swapAToB': True,
        'inputAmount': '1000000000',
        'slippageBps': 200
    }
)
data = response.json()
```
</CodeGroup>

### Path Parameters

<ParamField path="proposalPda" type="string" required>
  The Solana PDA of the proposal
</ParamField>

### Request Body

<ParamField body="wallet" type="string" required>
  The user's Solana wallet address (will be the fee payer and signer)
</ParamField>

<ParamField body="poolIndex" type="number" required>
  The pool index to swap in (0 = pass market, 1 = fail market)
</ParamField>

<ParamField body="swapAToB" type="boolean" required>
  Swap direction. `true` = token A to token B, `false` = token B to token A
</ParamField>

<ParamField body="inputAmount" type="string" required>
  Input amount in raw token units (including decimals)
</ParamField>

<ParamField body="slippageBps" type="number">
  Slippage tolerance in basis points. Default: 200 (2%)
</ParamField>

### Build Response

<ResponseField name="requestId" type="string">
  Unique identifier for this request. Required for the execute step.
</ResponseField>

<ResponseField name="transaction" type="string">
  Base58-encoded unsigned transaction
</ResponseField>

<ResponseField name="expiresAt" type="number">
  Unix timestamp (ms) when this request expires
</ResponseField>

<ResponseField name="quote" type="object">
  Quote information for the swap
</ResponseField>

#### Quote Object

| Field | Type | Description |
|-------|------|-------------|
| `inputAmount` | string | Input amount (raw units) |
| `outputAmount` | string | Expected output amount |
| `minOutputAmount` | string | Minimum output with slippage applied |
| `priceImpact` | number | Price impact as a decimal |

```json
{
  "requestId": "a1b2c3d4e5f6...",
  "transaction": "4vJ9JU1bJJE96FwQGq...",
  "expiresAt": 1704153600000,
  "quote": {
    "inputAmount": "1000000000",
    "outputAmount": "980000000",
    "minOutputAmount": "960400000",
    "priceImpact": 0.0102
  }
}
```

---

## Execute Transaction

`POST /dao/proposal/:proposalPda/swap/execute`

Executes a signed swap transaction that was previously built.

<CodeGroup>
```bash curl
curl -X POST https://api.zcombinator.io/dao/proposal/ABC123.../swap/execute \
  -H "Content-Type: application/json" \
  -d '{
    "requestId": "a1b2c3d4e5f6...",
    "signedTransaction": "4vJ9JU1bJJE96FwQGq..."
  }'
```
```javascript fetch
const response = await fetch(
  'https://api.zcombinator.io/dao/proposal/ABC123.../swap/execute',
  {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      requestId: 'a1b2c3d4e5f6...',
      signedTransaction: bs58.encode(signedTx.serialize())
    })
  }
);
const { success, signature } = await response.json();
```
```python requests
import requests

response = requests.post(
    'https://api.zcombinator.io/dao/proposal/ABC123.../swap/execute',
    json={
        'requestId': 'a1b2c3d4e5f6...',
        'signedTransaction': '<base58-encoded-signed-transaction>'
    }
)
data = response.json()
```
</CodeGroup>

### Request Body

<ParamField body="requestId" type="string" required>
  The request ID returned from the build endpoint
</ParamField>

<ParamField body="signedTransaction" type="string" required>
  Base58-encoded transaction with user's signature
</ParamField>

### Execute Response

<ResponseField name="success" type="boolean">
  Whether the transaction was successfully submitted and confirmed
</ResponseField>

<ResponseField name="signature" type="string">
  The Solana transaction signature
</ResponseField>

<ResponseField name="proposalPda" type="string">
  The proposal PDA
</ResponseField>

<ResponseField name="poolPda" type="string">
  The pool that was swapped in
</ResponseField>

```json
{
  "success": true,
  "signature": "5K8M3H...",
  "proposalPda": "ABC123...",
  "poolPda": "Pool789..."
}
```

---

## Error Responses

<AccordionGroup>
  <Accordion title="400 - Invalid proposal PDA">
    ```json
    { "error": "Invalid proposal PDA" }
    ```
  </Accordion>
  <Accordion title="400 - Invalid wallet">
    ```json
    { "error": "Invalid or missing wallet" }
    ```
  </Accordion>
  <Accordion title="400 - Missing parameters">
    ```json
    { "error": "Missing required fields: poolIndex, swapAToB, inputAmount" }
    ```
  </Accordion>
  <Accordion title="400 - Proposal not active">
    ```json
    {
      "error": "Proposal is not active",
      "state": "resolved",
      "message": "Trading is only available when proposal is in pending state"
    }
    ```
  </Accordion>
  <Accordion title="400 - Request not found or expired">
    ```json
    { "error": "Request not found or expired" }
    ```
  </Accordion>
  <Accordion title="400 - Transaction modified">
    ```json
    { "error": "Transaction verification failed: transaction has been modified" }
    ```
  </Accordion>
  <Accordion title="400 - Missing signature">
    ```json
    { "error": "Transaction verification failed: User wallet has not signed" }
    ```
  </Accordion>
  <Accordion title="400 - Blockhash expired">
    ```json
    { "error": "Invalid transaction: blockhash is expired. Please create a new transaction." }
    ```
  </Accordion>
  <Accordion title="404 - Proposal not found">
    ```json
    {
      "error": "Proposal not found on-chain",
      "details": "Account not found..."
    }
    ```
  </Accordion>
</AccordionGroup>

---

## Complete Example

```javascript
import { Transaction } from '@solana/web3.js';
import bs58 from 'bs58';

async function swapTokens(proposalPda, wallet, poolIndex, swapAToB, inputAmount, signTransaction) {
  // 1. Build the transaction
  const buildRes = await fetch(
    `${API_URL}/dao/proposal/${proposalPda}/swap/build`,
    {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        wallet,
        poolIndex,
        swapAToB,
        inputAmount,
        slippageBps: 200
      })
    }
  );
  const { requestId, transaction, quote } = await buildRes.json();

  console.log(`Swapping ${quote.inputAmount} for ~${quote.outputAmount}`);

  // 2. Decode and sign the transaction
  const tx = Transaction.from(bs58.decode(transaction));
  const signedTx = await signTransaction(tx);

  // 3. Execute the signed transaction
  const execRes = await fetch(
    `${API_URL}/dao/proposal/${proposalPda}/swap/execute`,
    {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        requestId,
        signedTransaction: bs58.encode(signedTx.serialize())
      })
    }
  );

  return execRes.json();
}
```

---

## Notes

- Transactions must be signed within 15 minutes of building
- The `requestId` ties the build and execute steps together
- Slippage protects against price movements between quote and execution
- View completed transactions on [Solscan](https://solscan.io)
